---
title: "Práctico 1: Tablas de contingencia y Chi-cuadrado"
css: styles.css
---

## Objetivo del práctico

El objetivo de este práctico es construir tablas de contingencia a partir de variables categóricas
y aplicar la prueba de independencia Chi-cuadrado (X²), tanto de forma manual como mediante R,
con el fin de interpretar la asociación entre variables.

Para ello y de forma ilustrativa, utilizaremos la base de datos de la cuarta ola del Estudio Longitudinal Social de Chile 2019 con el objetivo de analizar agrupaciones de variables categóricas nominales.

## Preparación de los datos

Antes de comenzar, prepararemos nuestros datos. Iniciamos cargando las librerias necesarias.

```{r, eval=FALSE}
pacman::p_load(tidyverse, # Manipulacion datos
               sjPlot, # Tablas
               psych, # Correlaciones
               DescTools, # Tablas
               gginference, # Visualizacion 
               rempsyc, # Reporte
               broom) # Varios

options(scipen = 999) # para desactivar notacion cientifica
rm(list = ls()) # para limpiar el entorno de trabajo
```

Luego vamos a cargar la base de datos directamente desde internet (En este caso la base de datos ELSOC esta alojada en Harvard Dataverse)

```{r, eval=FALSE}
#Cargamos la base de datos desde internet
load(url("https://dataverse.harvard.edu/api/access/datafile/7245118")) 

dim(elsoc_long_2016_2022.2)
```
```{r, eval=FALSE}
[1] 18035   750
```
- Contamos con 750 variables (columnas) y 18035 observaciones (filas).

```{r, eval=FALSE}
proc_data <- elsoc_long_2016_2022.2 %>% filter(ola=="4") %>% 
  select(c29, # Confianza generalizada
         m01# nivel educacional
         )

proc_data <- proc_data %>% sjlabelled::set_na(., na = c(-999, -888, -777, -666))
# Comprobar
names(proc_data)
```
**Se renombran las variables para mayor claridad:**

- m01 → educacion (nivel educacional).

- c25 → aut_demo (preferencia entre autoritarismo o democracia).

- Se elimina los NA´s (Importante verificar como es que funcionan los NA´s o si realmente tiene)}

- Con names(proc_data) vemos los nombres de las variables (columnas)


```{r, eval=FALSE}
proc_data$educacion <- car::recode(proc_data$educacion, "c(1,2,3)=1; c(4,5)=2; c(6,7,8,9,10)=3")

proc_data$educacion <- sjlabelled::set_labels(proc_data$educacion,
                                              labels=c( "Educación básica"=1,
                                                        "Educación media"=2,
                                                        "Educación superior"=3))


sjmisc::frq(proc_data$educacion)
```
**La función car::recode() agrupa categorías originales de la variable educacion en tres niveles más generales:**

Valores 1,2,3 → se recodifican como 1 (Educación básica).

Valores 4,5 → se recodifican como 2 (Educación media).

Valores 6,7,8,9,10 → se recodifican como 3 (Educación superior).

### El objetivo es simplificar la variable educacional en tres grupos.

**Ahora cuando usamos este codigo:**
proc_data$educacion <- sjlabelled::set_labels(proc_data$educacion, labels=c("Educación básica"=1, "Educación media"=2, "Educación superior"=3))

- Lo que estamos haciendo en el fondo es poner etiquetas de valor para que los numeros (1,2,3) tengan nombres legibles.

```{r, eval=FALSE}
#sjmisc::frq(proc_data$educacion)

Value |              Label |    N | Raw % | Valid % | Cum. %
------------------------------------------------------------
    1 |   Educación básica |  781 | 22.86 |   22.88 |  22.88
    2 |    Educación media | 1432 | 41.91 |   41.96 |  64.84
    3 | Educación superior | 1200 | 35.12 |   35.16 | 100.00
 <NA> |               <NA> |    4 |  0.12 |    <NA> |   <NA>
```
**La función frq() del paquete sjmisc muestra una tabla de frecuencias:**

- Número de casos en cada categoría.

- Porcentaje relativo.

- Valores perdidos (NA) si los hay.

# Tabla de contingencia

Una tabla de contingencia es una de las maneras más simples y útiles para representar el cruce entre dos variables categóricas.

Con ella, podemos obtener en las celdas las frecuencias conjuntas entre ambas variables, es decir, cuántos casos de una determinada categoría de la variable Y ocurren conjuntamente con una determinada categoría de la variable X.

Además, podemos presentar los totales de cada fila y columna al exterior de la tabla, también conocidas como frecuencias marginales.

En este caso veremos un ejemplo con nivel educacional y autoritarismo o democracia.

```{r, eval=FALSE}
sjPlot::sjt.xtab(var.row = proc_data$educacion, var.col = proc_data$aut_demo, 
                 show.summary = F, emph.total = T, encoding = "UTF-8")
```

[Ver tabla de contingencia](practicos/Imagenesygraficos/tabla_contingencia.html)

*Sumado a esto, tenemos:

**Frecuencias absolutas:** números que aparencen en la tabla (ya sean conjuntas o marginales)

**Frecuencias relativas:**
- porcentaje fila: % que cada frecuencia conjunta representa sobre la marginal de su fila
- porcentaje columna: % que cada frecuencia conjunta representa sobre la marginal de su columna
- porcentaje total: % que cada frecuencia conjunta representa sobre el número total de casos de la tabla

Veamos cómo incorporar el porcentaje fila y columna en la tabla.

```{r, eval=FALSE}
sjPlot::sjt.xtab(var.row = proc_data$educacion, 
                 var.col = proc_data$aut_demo, 
                 show.summary = F, 
                 emph.total = T, 
                 show.row.prc = T, # porcentaje fila
                 show.col.prc = T, # porcentaje columna
                 encoding= "UTF-8")
```

[Ver tabla de contingencia](practicos/Imagenesygraficos/tabla_contingenciapor.html)

Aquí, los porcentajes fila aparecen en azul y los porcentajes columna en verde.

# Prueba Chi-cuadrado (X²)

Calculo en R.

```{r, eval=FALSE}
chi_results <- chisq.test(table(proc_data$educacion, proc_data$aut_demo))

stats.table <- tidy(chi_results, conf_int = T)
nice_table(stats.table)
```

[Ver tabla de contingencia](practicos/Imagenesypracticos/chicuadrado.html)

Visualizacion de esta prueba y su zona de rechazo.

```{r, eval=FALSE}
ggchisqtest(chi_results)
```


### Cálculo manual de X²

### Cálculo de X² en R

## Interpretación del resultado

