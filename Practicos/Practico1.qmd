# üéØ Objetivos del Pr√°ctico

## Prop√≥sito General
Este pr√°ctico tiene como objetivo desarrollar competencias en el **an√°lisis de asociaci√≥n entre variables categ√≥ricas** mediante:

1. **Construcci√≥n** de tablas de contingencia
2. **Aplicaci√≥n** de la prueba de independencia Chi-cuadrado (œá¬≤)
3. **Interpretaci√≥n** de resultados estad√≠sticos y sustantivos
4. **Contraste** entre c√°lculo manual y automatizado

## Contexto del Estudio
Utilizaremos la **cuarta ola (2019) del Estudio Longitudinal Social de Chile (ELSOC)**, una encuesta panel representativa nacional, para analizar la relaci√≥n entre **nivel educacional** y **preferencias pol√≠tico-democr√°ticas**.

---

# üîß Preparaci√≥n del Entorno Anal√≠tico

## 1.1 Instalaci√≥n y Carga de Paquetes

```{r librerias, eval=FALSE}
# Carga de paquetes necesarios
pacman::p_load(
  tidyverse,      # Manipulaci√≥n y visualizaci√≥n de datos
  sjPlot,         # Tablas y gr√°ficos para ciencias sociales
  psych,          # An√°lisis psicom√©tricos y correlaciones
  DescTools,      # Funciones descriptivas avanzadas
  gginference,    # Visualizaci√≥n de pruebas inferenciales
  rempsyc,        # Reportes estad√≠sticos formateados
  broom,          # Organizaci√≥n de resultados en dataframes
  sjlabelled,     # Manejo de etiquetas de variables
  sjmisc          # Funciones auxiliares para an√°lisis
)
```
## 1.2 Configuraci√≥n del entorno R
- options(scipen = 999)    # Desactiva notaci√≥n cient√≠fica
- rm(list = ls())          # Limpia el entorno de trabajo
- set.seed(123)            # Fija semilla para reproducibilidad

# ‚è≥ Carga de la base de datos

Luego vamos a cargar la base de datos directamente desde internet (En este caso la base de datos ELSOC esta alojada en Harvard Dataverse)


```{r, eval=FALSE}
#Cargamos la base de datos desde internet
load(url("https://dataverse.harvard.edu/api/access/datafile/7245118")) 

dim(elsoc_long_2016_2022.2)
```
**Salida Esperada:**

```{r, eval=FALSE}
[1] 18035   750
```
**Interpretaci√≥n:** La base contiene 18,035 casos (entrevistados) medidos en 750 variables a lo largo de diferentes olas.

---

# üßπ Selecci√≥n y Limpieza de Variables:

```{r, eval=FALSE}
proc_data <- elsoc_long_2016_2022.2 %>% filter(ola=="4") %>% 
  select(c29, # Confianza generalizada
         m01# nivel educacional
         )

proc_data <- proc_data %>% sjlabelled::set_na(., na = c(-999, -888, -777, -666))
# Comprobar
names(proc_data)
```
**Se renombran las variables para mayor claridad:**

- m01 ‚Üí educacion (nivel educacional).

- c25 ‚Üí aut_demo (preferencia entre autoritarismo o democracia).

- Se elimina los NA¬¥s (Importante verificar como es que funcionan los NA¬¥s o si realmente tiene)}

- Con names(proc_data) vemos los nombres de las variables (columnas)

---

# üß¨ Recodificaci√≥n de variables:

```{r, eval=FALSE}
proc_data$educacion <- car::recode(proc_data$m01, "c(1,2,3)=1; c(4,5)=2; c(6,7,8,9,10)=3")

proc_data$educacion <- sjlabelled::set_labels(proc_data$educacion,
                                              labels=c( "Educaci√≥n b√°sica"=1,
                                                        "Educaci√≥n media"=2,
                                                        "Educaci√≥n superior"=3))


sjmisc::frq(proc_data$educacion)
```
**La funci√≥n car::recode() agrupa categor√≠as originales de la variable educacion en tres niveles m√°s generales:**

Valores 1,2,3 ‚Üí se recodifican como 1 (Educaci√≥n b√°sica).

Valores 4,5 ‚Üí se recodifican como 2 (Educaci√≥n media).

Valores 6,7,8,9,10 ‚Üí se recodifican como 3 (Educaci√≥n superior).

El objetivo es simplificar la variable educacional en tres grupos.

**La funcion sjlabelled::set_labels()en el fondo es poner etiquetas de valor para que los numeros (1,2,3) tengan nombres legibles.**

```{r, eval=FALSE}
#sjmisc::frq(proc_data$educacion)

Value |              Label |    N | Raw % | Valid % | Cum. %
------------------------------------------------------------
    1 |   Educaci√≥n b√°sica |  781 | 22.86 |   22.88 |  22.88
    2 |    Educaci√≥n media | 1432 | 41.91 |   41.96 |  64.84
    3 | Educaci√≥n superior | 1200 | 35.12 |   35.16 | 100.00
 <NA> |               <NA> |    4 |  0.12 |    <NA> |   <NA>
```
**La funci√≥n frq() del paquete sjmisc muestra una tabla de frecuencias:**

- N√∫mero de casos en cada categor√≠a.

- Porcentaje relativo.

- Valores perdidos (NA) si los hay.

## Tabla de contingencia

Definici√≥n: Una **tabla de contingencia** (o tabla cruzada) es una matriz que muestra la distribuci√≥n conjunta de dos variables categ√≥ricas.

**Componentes Esenciales:**

- **Frecuencias observadas:** Conteos en cada combinaci√≥n de categor√≠as

- **Marginales de fila:** Totales por categor√≠a de la variable X

- **Marginales de columna:** Totales por categor√≠a de la variable Y

- **Gran total:** N√∫mero total de casos v√°lidos

Veremos un ejemplo conm ss_salud y universitaria:

```{r, eval=FALSE}
sjPlot::sjt.xtab(var.row = proc_data$educacion, var.col = proc_data$c29, 
                 show.summary = F, emph.total = T, encoding = "UTF-8")
```
<div class="table-container" style="overflow-x: auto; margin: 30px 0;"><table class="contingency-table" style="width: 100%; border-collapse: collapse; font-family: 'Segoe UI', sans-serif;"> <caption style="caption-side: bottom; text-align: center; padding: 10px; font-style: italic; color: #666;"> <strong>Tabla 1:</strong> Distribuci√≥n conjunta entre nivel educacional y preferencia por mecanismo de cambio constitucional (N = 3,032) </caption><thead> <tr style="background-color: #2c2c2c; color: white;"> <th style="border: 2px solid #444; padding: 12px; text-align: center; font-weight: bold;" rowspan="2">Nivel Educacional</th> <th style="border: 2px solid #444; padding: 12px; text-align: center; font-weight: bold;" colspan="4">Mecanismo de Cambio Constitucional</th> <th style="border: 2px solid #444; padding: 12px; text-align: center; font-weight: bold;" rowspan="2">Total por Educaci√≥n</th> </tr> <tr style="background-color: #3a3a3a; color: white;"> <th style="border: 1px solid #555; padding: 10px; text-align: center;">Grupo de Expertos</th> <th style="border: 1px solid #555; padding: 10px; text-align: center;">Parlamento</th> <th style="border: 1px solid #555; padding: 10px; text-align: center;">Asamblea Constituyente</th> <th style="border: 1px solid #555; padding: 10px; text-align: center;">Total Mecanismo</th> </tr> </thead><tbody> <tr style="background-color: #f9f9f9;"> <td style="border: 1px solid #ddd; padding: 12px; font-weight: bold;">Educaci√≥n B√°sica</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">138</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">30</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">446</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center; font-weight: bold;">614</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center; background-color: #e8f4f8; font-weight: bold;">614</td> </tr><tr style="background-color: #fff;"> <td style="border: 1px solid #ddd; padding: 12px; font-weight: bold;">Educaci√≥n Media</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">277</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">31</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">964</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center; font-weight: bold;">1,272</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center; background-color: #e8f4f8; font-weight: bold;">1,272</td> </tr><tr style="background-color: #f9f9f9;"> <td style="border: 1px solid #ddd; padding: 12px; font-weight: bold;">Educaci√≥n Superior</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">286</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">17</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">843</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center; font-weight: bold;">1,146</td> <td style="border: 1px solid #ddd; padding: 12px; text-align: center; background-color: #e8f4f8; font-weight: bold;">1,146</td> </tr><tr style="background-color: #2c2c2c; color: white; font-weight: bold;"> <td style="border: 2px solid #444; padding: 12px; text-align: center;">Total General</td> <td style="border: 2px solid #444; padding: 12px; text-align: center;">701</td> <td style="border: 2px solid #444; padding: 12px; text-align: center;">78</td> <td style="border: 2px solid #444; padding: 12px; text-align: center;">2,253</td> <td style="border: 2px solid #444; padding: 12px; text-align: center;">3,032</td> <td style="border: 2px solid #444; padding: 12px; text-align: center; background-color: #1a5276; color: white;">3,032</td> </tr> </tbody> </table> </div>

*Sumado a esto, tenemos:

**Frecuencias absolutas:** n√∫meros que aparencen en la tabla (ya sean conjuntas o marginales)

**Frecuencias relativas:**
- porcentaje fila: % que cada frecuencia conjunta representa sobre la marginal de su fila
- porcentaje columna: % que cada frecuencia conjunta representa sobre la marginal de su columna
- porcentaje total: % que cada frecuencia conjunta representa sobre el n√∫mero total de casos de la tabla

Veamos c√≥mo incorporar el porcentaje fila y columna en la tabla.

```{r, eval=FALSE}
sjPlot::sjt.xtab(var.row = proc_data$educacion, 
                 var.col = proc_data$aut_demo, 
                 show.summary = F, 
                 emph.total = T, 
                 show.row.prc = T, # porcentaje fila
                 show.col.prc = T, # porcentaje columna
                 encoding= "UTF-8")
```

<iframe src="http://localhost:20601/session/file38984bb8608f.html" 
        width="100%" 
        height="600px" 
        style="border: none; margin: 20px 0;">
  Tu navegador no soporta iframes. [Ver tabla externa](http://localhost:20601/session/file38984bb8608f.html)
</iframe>

Aqu√≠, los porcentajes fila aparecen en azul y los porcentajes columna en verde.

# Prueba Chi-cuadrado (X¬≤)

Calculo en R.

```{r, eval=FALSE}
chi_results <- chisq.test(table(proc_data$educacion, proc_data$aut_demo))

stats.table <- tidy(chi_results, conf_int = T)
nice_table(stats.table)
```

[Ver tabla de contingencia](practicos/Imagenesypracticos/chicuadrado.html)

Visualizacion de esta prueba y su zona de rechazo.

```{r, eval=FALSE}
ggchisqtest(chi_results)
```


### C√°lculo manual de X¬≤

### C√°lculo de X¬≤ en R

## Interpretaci√≥n del resultado

